% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/find-centers-.R
\name{find_centers}
\alias{find_centers}
\title{Initialize centroids for \code{\link[=cluster_xmap]{cluster_xmap()}}}
\usage{
find_centers(xmap, qnt, fine_phase = NULL, saveas = "centers0.csv")
}
\arguments{
\item{xmap}{an \code{qm_xmap} class object generated by \code{\link[=read_xmap]{read_xmap()}}}

\item{qnt}{an \code{qm_qnt} class object generated by \code{\link[=read_qnt]{read_qnt()}}`}

\item{fine_phase}{A character vector to specify fine grained phases
which tend to comprise multi-phase pixels.
See \href{#multi-phase-pixels}{"Multi-phase pixels"} section for details.}

\item{saveas}{File name to save result. \code{FALSE} if not saving.}
}
\description{
Initial centroids are guessed by comaring data from
spot analysis and x-ray mapping.
First, phase identification is done on some pixels in X-ray maps which
is quantified by spot analysis.
Second, for each phase, \code{\link{median}} values of X-ray maps are utilized as
initial centroids.
Note that X-ray mapping inevitably involves multi-phase pixels, and
such pixels can be a member of training data set for initial centroids.
See \href{#multi-phase-pixels}{"Multi-phase pixels"} section for
automatic and manual special cares on such pixels.
}
\section{Multi-phase pixels}{

X-ray mapping inevitably involves multi-phase pixels,
especially for fine-grained phases.
When the multi-phase pixels are member of training data set,
guessing initial centroids can be biased.
This is why guessing centroids is based on \code{\link{median}} instead of \code{\link{mean}}.
However, if pixels to guess centroids for cetrtain phase are
comprising a large number of or even a full of multi-phase pixels,
\code{\link{median}} is still vulnerable.
For example, refer to a reprinted figure 5 from
\href{https://doi.org/10.2138/am-2018-6323CCBY}{Yasumoto et al. (2018)}, and
captions in original article.
Phases such as Amp, Di, and Pl are outlying the regression curves due to
multi-phase pixels.
For these phases, median values of peak X-ray intensities from
X-ray mapping are unreliable values for initial centroids.
Thus, training data set should exclude data points from multi-phase pixels.

\if{html}{\figure{yasumoto-etal-2018-ccby-fig05.png}{options: width=100\%}}

Multi-phase pixels are automatically excluded by defining them as
data points outlying 99\% predictive intervals in a following model:
\deqn{I_{i, \mathrm{map}} \sim Poisson(\beta_i I_{i, \mathrm{qnt}}),}{%
  I_{i, \mathrm{map}} \sim Poisson(\beta_i I_{i, \mathrm{qnt}}),}
where
\eqn{I_{i, \mathrm{map}}} and
\eqn{I_{i, \mathrm{qnt}}} are peak X-ray intensities of an element, \eqn{i},
from X-ray mapping and quantitative spot analysis, respectively.
\eqn{\beta_i} is a regression coefficient for an element, \eqn{i}.

In case all data points for certain phase are regarded as multi-phase pixels
automatically by the above model or manually by the \code{fine_phase} paramter,
initial centroids are set to medians of predictions by the above model.
}

\references{
Yasumoto, A., Yoshida, K., Kuwatani, T., Nakamura, D., Svojtka, M., &
Hirajima, T. (2018).
A rapid and precise quantitative electron probe chemical mapping technique
and its application to an ultrahigh-pressure eclogite
from the Moldanubian Zone of the Bohemian Massif
(Nov√© Dvory, Czech Republic).
American Mineralogist, 103(10), 1690-1698,
\url{https://doi.org/10.2138/am-2018-6323CCBY}.
}
