<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Initialize centroids for cluster_xmap() — find_centers • qntmap</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Initialize centroids for cluster_xmap() — find_centers" />
<meta property="og:description" content="Initial centroids are determined by comparing data points from the quantified
spots and mapped pixels from the same coordinates.
First, mapping intensities counted from multi-phase pixels are removed from
the dataset (See &quot;Multi-phase pixels&quot; section).
Second, if the removal reduces sample size of some phases to less than 10,
then the mapping intensities are restored from signal intensities from spot
analysis.
Third, for each phase, median values of signal intensities are utilized
as initial centroids.
Forth, if there are missing values especially for intensities of electrons
(secondary, backscatter, ...), imputation is performed for them
(See &quot;Impute missings&quot; section)." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133172060-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133172060-1');
</script>


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qntmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/qntmap.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/add_phase.html">Add phases after EPMA analysis</a>
    </li>
    <li>
      <a href="../articles/parameterize.html">Inherit parameters from previously quantified maps</a>
    </li>
    <li>
      <a href="../articles/read-incomplete-data.html">Read incomplete data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/atusy/qntmap/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Initialize centroids for <code><a href='cluster_xmap.html'>cluster_xmap()</a></code></h1>
    <small class="dont-index">Source: <a href='https://github.com/atusy/qntmap/blob/master/R/find-centers-.R'><code>R/find-centers-.R</code></a></small>
    <div class="hidden name"><code>find_centers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Initial centroids are determined by comparing data points from the quantified
spots and mapped pixels from the same coordinates.
First, mapping intensities counted from multi-phase pixels are removed from
the dataset (See "Multi-phase pixels" section).
Second, if the removal reduces sample size of some phases to less than 10,
then the mapping intensities are restored from signal intensities from spot
analysis.
Third, for each phase, <code><a href='https://rdrr.io/r/stats/median.html'>median</a></code> values of signal intensities are utilized
as initial centroids.
Forth, if there are missing values especially for intensities of electrons
(secondary, backscatter, ...), imputation is performed for them
(See "Impute missings" section).</p>
    </div>

    <pre class="usage"><span class='fu'>find_centers</span><span class='op'>(</span>
  <span class='va'>xmap</span>,
  <span class='va'>qnt</span>,
  phase <span class='op'>=</span> <span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span>,
  element <span class='op'>=</span> <span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span>,
  saveas <span class='op'>=</span> <span class='st'>"centers0.csv"</span>,
  epma <span class='op'>=</span> <span class='fu'><a href='tidy_epma.html'>tidy_epma</a></span><span class='op'>(</span><span class='va'>qnt</span>, <span class='va'>xmap</span><span class='op'>)</span>,
  fine_phase <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>xmap</th>
      <td><p>An object generated by <code><a href='read_xmap.html'>read_xmap()</a></code></p></td>
    </tr>
    <tr>
      <th>qnt</th>
      <td><p>An object generated by <code><a href='read_qnt.html'>read_qnt()</a></code></p></td>
    </tr>
    <tr>
      <th>phase</th>
      <td><p>Selected ones are referenced to detect outliers. Default selects everything.
Tidy selection is available. For example <code><a href='https://rdrr.io/r/base/c.html'>c(Si, Ti)</a></code> selects them, and
<code><a href='https://rdrr.io/r/base/c.html'>c(-Si, -Ti)</a></code> selects everything except them.</p></td>
    </tr>
    <tr>
      <th>element</th>
      <td><p>Selected ones are referenced to detect outliers. Default selects everything.
Tidy selection is available. For example <code><a href='https://rdrr.io/r/base/c.html'>c(Si, Ti)</a></code> selects them, and
<code><a href='https://rdrr.io/r/base/c.html'>c(-Si, -Ti)</a></code> selects everything except them.</p></td>
    </tr>
    <tr>
      <th>saveas</th>
      <td><p>File name to save result. <code>FALSE</code> if not saving.</p></td>
    </tr>
    <tr>
      <th>epma</th>
      <td><p>A value returned by <code><a href='tidy_epma.html'>tidy_epma()</a></code></p></td>
    </tr>
    <tr>
      <th>fine_phase</th>
      <td><p>Deprecated as of qntmap &gt; 0.4.0. Use <code>phase</code> instead.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed on to <code><a href='find_outlier.html'>find_outlier</a></code></p><dl>
    <dt><code>interval</code></dt><dd><p>A type of the interval. Data points outside intervals are treated as outliers.
If <code>"prediction"</code> (default), prediction intervals are used based on Poisson process.
If `"tukey"``, conditional lower and upper whiskers are used where the lower is
$Q_1/4 - 1.5 IQR$ and the upper is $Q_3/4 + 1.5 IQR$.</p></dd>
    <dt><code>method</code></dt><dd><p>Applicable when <code>interval = "prediction"</code>.
If <code>"rq"</code> (default), quantile regression is performed (<code><a href='https://rdrr.io/pkg/quantreg/man/rq.html'>quantreg::rq()</a></code>).
If <code>"lsfit"</code>, least square regression is performed (<code><a href='https://rdrr.io/r/stats/lsfit.html'>stats::lsfit()</a></code>).</p></dd>
    <dt><code>percentile</code></dt><dd><p>A percentile of predictive interaval.
Applicable when <code>interval = "prediction"</code>.</p></dd>
  
</dl></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="multi-phase-pixels"><a class="anchor" href="#multi-phase-pixels"></a>Multi-phase pixels</h2>

    

<p>X-ray mapping inevitably involves multi-phase pixels, especially for
fine-grained phases. When the multi-phase pixels are member of training
data set, initial centroids can be biased. This is why guessing
centroids is based on <code><a href='https://rdrr.io/r/stats/median.html'>median()</a></code> instead of <code><a href='mean.html'>mean()</a></code>. However, if pixels
to guess centroids for cetrtain phase are comprising a large number of or
even a full of multi-phase pixels, <code><a href='https://rdrr.io/r/stats/median.html'>median()</a></code> is still vulnerable. For
example, refer to a reprinted figure 5 from
<a href='https://doi.org/10.2138/am-2018-6323CCBY'>Yasumoto et al. (2018)</a>, and
captions in original article. Phases such as Amp, Di, and Pl are outlying
the regression curves due to multi-phase pixels. For these phases,
median values of peak X-ray intensities from X-ray mapping are unreliable
values for initial centroids. Thus, data points from multi-phase pixels
should be regarded as outliers, and imputetions should be performed on them.
In qntmap, mapping intensities are simply substituted by spot intensities.</p>
<p>Outliers are identified by examining if confidence intervals data points
overlap with predictive intervals or conditional whiskers of Tukey's choice.</p>
    <h2 class="hasAnchor" id="impute-missings"><a class="anchor" href="#impute-missings"></a>Impute missings</h2>

    

<p>When spot analysis on some phases are performed outside the mapping area,
X-ray intensities under mapping conditions can be calculated from
quantified peak intensities. However, intensities of secondary and backscatter
electrons cannot be calculated because electrons are generally not
analyzed in spot analysis. Thus, imputation is performed. First, calculate
median values of mapping X-ray intensities. Second, find a pixel in the map
which have closest value to the median values. Third, retrive electron
intensities from that pixel and utilize as a centroid.</p>
<p>Note that missing values may remain if certain elements are analyzed in
spot analysis but not in mapping analysis.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Yasumoto, A., Yoshida, K., Kuwatani, T., Nakamura, D., Svojtka, M., &amp;
Hirajima, T. (2018).
A rapid and precise quantitative electron probe chemical mapping technique
and its application to an ultrahigh-pressure eclogite
from the Moldanubian Zone of the Bohemian Massif
(Nové Dvory, Czech Republic).
American Mineralogist, 103(10), 1690-1698,
<a href='https://doi.org/10.2138/am-2018-6323CCBY'>https://doi.org/10.2138/am-2018-6323CCBY</a>.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#multi-phase-pixels">Multi-phase pixels</a></li>
      <li><a href="#impute-missings">Impute missings</a></li>
      <li><a href="#references">References</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Atsushi Yasumoto, Japan Agency for Marine-Earth Science and Technology (JAMSTEC), JST PRESTO (Grant No. JPMJPR1676).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '7d529d89cf9d49d99a324143613b100e',
    indexName: 'qntmap',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


