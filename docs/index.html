<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhance quantitative analysis of EPMA data • qntmap</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Enhance quantitative analysis of EPMA data">
<meta property="og:description" content="A main function of this packages is 
    to produce chemical mass concentration map based on 
    x-ray maps and some quantified points among the mapped area.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">qntmap</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atusy/qntmap/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<div id="overview" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1></div>
<p>This package provides functions to convert element characteristic X-ray intensity maps into element mass concentration maps.<br>
Current version supports data from JEOL-style electron probe microanalyer (EPMA).<br>
For conversion, you need to run spot analysis before mapping analysis.<br>
See “How to” section for usage and Yasumoto et al. (submitted) for implementations.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Install devtools package if you haven’t.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"devtools"</span>)</code></pre></div>
<p>Then, run following code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"atusy/qntmap"</span>)</code></pre></div>
</div>
<div id="how-to" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to" class="anchor"></a>How to</h1>
<div id="epma-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#epma-analysis" class="anchor"></a>EPMA analysis</h2>
<p>QntMap handles matrix effect by preparing internal standards based on spot analysis.</p>
<div id="spot-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#spot-analysis" class="anchor"></a>Spot analysis</h3>
<ul>
<li>Analytical conditions
<ul>
<li>Same as those conventionally applied in your lab.</li>
<li>Use wavelength-dispersive X-ray spectrometer</li>
</ul>
</li>
<li>Spots to be analyzed
<ul>
<li>
<strong>20 spots per phase</strong> in the area to be mapped (the more is better).</li>
<li>It is better but not necessary to quantify grains larger than mapping probe diameter.</li>
<li>Make sure at least <strong>20 spots per element</strong> are analyzing grains larger than mapping probe diameter.</li>
</ul>
</li>
<li>Commenting analysis
<ul>
<li>Give same comments on the same phase with the similar compositions. Do not number them.</li>
<li>e.g., quartz, plagioclase, …</li>
<li>Otherwise, comment them with different name. This is important treatment for phase identification and handling matrix effect.</li>
<li>e.g., garnet-core, garnet-rim</li>
<li>If you give comments containing underscore such as “garnet_core” and “garnet_rim”, then they are treated as if different phases in phase identification, but are treated as if their matrix effect are approximately same.</li>
<li>Alternatively, give comments manually by external file.</li>
</ul>
</li>
</ul>
<p>Spot quantitative analytical conditions in your lab.</p>
</div>
<div id="mapping-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-analysis" class="anchor"></a>Mapping analysis</h3>
<ul>
<li>Analytical conditions
<ul>
<li>Acceralating voltage should be same as one applied in spot analysis.</li>
<li>Probe diameter should be larger than spot analysis. The larger saves more time, but decreases spatial resolutions.</li>
<li>Probe current is recommended to be 100 nA following Lanari et al. (2014).</li>
<li>Dwell time is recommended to be 0.1 - 0.3 sec following Lanari et al. (2014).</li>
<li>Note that increasing probe current accepts decreasing dwell time, but probe current must not be too high to saturate X-ray detectors. If you prefer high probe current in some reason, consider changing dispersive crystals from those chosen in spot analysis.
<ul>
<li>e.g., chose PET instead of TAP for Si</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="example-of-analytical-conditions" class="section level3">
<h3 class="hasAnchor">
<a href="#example-of-analytical-conditions" class="anchor"></a>Example of analytical conditions</h3>
<p>Yasumoto et al. (submitted)</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Spot</th>
<th align="right">Map</th>
<th align="left">Comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Acceralating Voltate</td>
<td align="right">15 kV</td>
<td align="right">15 kV</td>
<td align="left">Must be same in spot and map</td>
</tr>
<tr class="even">
<td align="left">Probe diameter</td>
<td align="right">3 μm</td>
<td align="right">20 μm</td>
<td align="left">Must be smaller in spot than map</td>
</tr>
<tr class="odd">
<td align="left">Probe current</td>
<td align="right">10 nA</td>
<td align="right">100 nA</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Peak dwell</td>
<td align="right">10 sec</td>
<td align="right">120 msec</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Background dwell</td>
<td align="right">5 sec</td>
<td align="right">NA</td>
<td align="left">No need to analyze in map</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="data-processing-with-qntmap-package-on-r" class="section level2">
<h2 class="hasAnchor">
<a href="#data-processing-with-qntmap-package-on-r" class="anchor"></a>Data processing with QntMap package on R</h2>
<div id="quantification" class="section level3">
<h3 class="hasAnchor">
<a href="#quantification" class="anchor"></a>Quantification</h3>
<p>By running following code, you’ll see that phase identification result in ‘clustering’ directory and mass concentration data as csv files in ‘qntmap’ directory both under the directory contaning mapping data.</p>
<div id="interactive-mode" class="section level4">
<h4 class="hasAnchor">
<a href="#interactive-mode" class="anchor"></a>Interactive mode</h4>
<p>Follow instructions shown by running the following code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(qntmap)
<span class="kw"><a href="reference/qntmap.html">qntmap</a></span>()</code></pre></div>
</div>
<div id="manual-mode-for-experts-example" class="section level4">
<h4 class="hasAnchor">
<a href="#manual-mode-for-experts-example" class="anchor"></a>Manual mode for experts (example)</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Required parameters</span>
wd &lt;-<span class="st"> 'path to the working directory'</span>
dir_map &lt;-<span class="st"> '.map/1'</span> <span class="co"># relative/absolute path to the directory containing ascii converted X-ray map files (1_map.txt, 2_map.txt, and so on)"</span>
dir_qnt &lt;-<span class="st"> '.qnt'</span> <span class="co"># relative/absolute path to the directory containing .qnt files (pkint.qnt, net.qnt, and so on)"</span>


<span class="co"># Optional parameters</span>
fine_phase &lt;-<span class="st"> </span><span class="ot">NULL</span> <span class="co"># A character vector to specify phases tend to be smaller than mapping probe diameter</span>
phase_list &lt;-<span class="st"> </span><span class="ot">NULL</span> <span class="co"># A csv file indicating phase of n-th quantitative point analysis</span>

<span class="co"># Run analysis</span>
<span class="kw">library</span>(qntmap)

<span class="co"># Set working directory</span>
<span class="kw">setwd</span>(wd)

<span class="co"># Load mapping data</span>
<span class="co"># Change value of DT (dead time in nanoseconds) depending on EPMA.</span>
<span class="co"># 1100 ns is a value applied by JEOL JXA-8105.</span>
xmap &lt;-<span class="st"> </span><span class="kw"><a href="reference/read_xmap.html">read_xmap</a></span>(dir_map, <span class="dt">DT =</span> <span class="dv">1100</span>)

<span class="co"># Compile quantitative data</span>
qnt &lt;-<span class="st"> </span><span class="kw"><a href="reference/read_qnt.html">read_qnt</a></span>(dir_qnt, <span class="dt">phase_list =</span> <span class="ot">NULL</span>)
## If you want to change phase names of each analysis different from those determined preliminary given during EPMA analysis, prepare csv file that indicates phase name, and input its path to phase_list parameter.
## In addition, make renew = TRUE.
## qnt &lt;- qnt_load(phase_list = "phase_list.csv", renew = TRUE)

<span class="co"># Determine initial cluster centers</span>
centers &lt;-<span class="st"> </span><span class="kw"><a href="reference/find_centers.html">find_centers</a></span>(<span class="dt">xmap =</span> xmap, <span class="dt">qnt =</span> qnt, <span class="dt">fine_phase =</span> fine_phase)

<span class="co"># Phase identification</span>
<span class="co"># assign integration = FALSE if you do not want to integrate underscored phases (e.g., garnet_a and garnet_b are integrated to garnet if TRUE)</span>
cls &lt;-<span class="st"> </span><span class="kw"><a href="reference/cluster_xmap.html">cluster_xmap</a></span>(xmap, centers)

<span class="co"># quantify X-ray maps</span>
qntmap &lt;-<span class="st"> </span><span class="kw"><a href="reference/quantify.html">qntmap_quantify</a></span>(
  <span class="dt">xmap =</span> xmap, <span class="dt">qnt =</span> qnt, <span class="dt">cluster =</span> cls, <span class="dt">fine_phase =</span> fine_phase
)</code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/atusy/qntmap/">https://​github.com/​atusy/​qntmap/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/atusy/qntmap/issues">https://​github.com/​atusy/​qntmap/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Atsushi YASUMOTO <br><small class="roles"> Author, copyright holder, maintainer </small>  </li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Atsushi YASUMOTO.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
